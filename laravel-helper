#! /bin/bash

export APPDIR=/opt/my-laravel

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m'

pushd $APPDIR

while getopts "dirlt:" OPTION; do
    case $OPTION in
    d)
        echo -e "\n${YELLOW}Updating code in $APPDIR${NC}\n"
        git pull
        ;;
    i)
        echo -e "\n${YELLOW}Installing dependencies${NC}\n"
        composer install
        ;;
    r)
        cho -e "${YELLOW}Refresh laravel instance${NC}\n"
        composer dump-autoload && php artisan cache:clear && php artisan config:clear && php artisan view:clear && php artisan config:cache && php artisan queue:restart
        echo -e "${YELLOW}Reset folder permissions${NC}\n"
        chown -R www-data:www-data $APPDIR && chmod -R 755 $APPDIR/storage && chmod -R 755 $APPDIR/bootstrap/cache
        ;;
    l)
        echo -e "\n${YELLOW}Laravel log${NC}\n"
        tail -f storage/logs/laravel-$(date +%Y-%m-%d).log
        ;;
    t)
        echo -e "\n${YELLOW}Laravel log${NC}\n"
        tail -n $OPTARG storage/logs/laravel-$(date +%Y-%m-%d).log
        ;;
    *)
        echo -e "${RED}Incorrect options provided${NC}"
        exit 1
        ;;
    esac
done

popd
